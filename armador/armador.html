<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PMS - Armador de Pedidos | Catálogo Digital</title>
  <meta name="description"
    content="Catálogo digital PMS - Arma tu pedido de gases industriales, extintores y repuestos">

  <!-- Font Awesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Header -->
  <header class="site-header">
    <div class="header-content">
      <div class="header-left">
        <nav class="main-nav" aria-label="Menú principal">
          <a href="../index.html">Inicio</a>
          <a href="armador.html" class="active">Nuestros productos</a>
        </nav>
      </div>

      <div class="header-right header-actions">
        <div class="cart-counter" onclick="scrollToCart()">
          <i class="fas fa-shopping-cart"></i>
          <span id="cartCount" class="cart-count">0</span>
        </div>
        <a href="tel:+595985920400"><i class="fas fa-phone"></i> 0985 920 400</a>
      </div>
    </div>
  </header>


  <!-- Contenido Principal -->
  <main class="main-content">
    <!-- Sidebar Categorías -->
    <aside class="categories-sidebar">
      <h2 class="categories-title">
        <i class="fas fa-list"></i> Categorías
      </h2>
      <div id="categoriesList">
        <!-- Se llena dinámicamente -->
      </div>
    </aside>

    <!-- Área de Productos -->
    <section class="products-area">
      <div class="products-header">
        <h2 id="categoryTitle">Todos los Productos</h2>
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Buscar productos..." id="searchInput">
        </div>
      </div>
      <div class="products-grid" id="productsGrid">
        <!-- Se llena dinámicamente -->
      </div>
    </section>

    <!-- Carrito -->
    <aside class="cart-sidebar">
      <h2 class="cart-title">
        <i class="fas fa-shopping-cart"></i> Mi Pedido
      </h2>
      <div id="cartContent">
        <div class="empty-cart">
          <i class="fas fa-shopping-cart"></i>
          <p>Tu carrito está vacío</p>
          <small>Agrega productos para comenzar tu pedido</small>
        </div>
      </div>
    </aside>
  </main>

  <script>
    // Base de datos de productos (JSON)
    const productDatabase = {
      categorias: {
        "repuestos-refrigeracion": {
          nombre: "Repuestos Refrigeración",
          descripcion: "Filtros, válvulas, aceites y componentes",
          icon: "fas fa-snowflake",
          productos: [
            { id: 1, codigo: "001", nombre: "Fundente de Aluminio 200Gr", precio: 95000, stock: 1200, imagen: "001.jpg" },
            { id: 2, codigo: "002", nombre: "Válvula de servicio 1/4", precio: 5000, stock: 5000, imagen: "002.jpg" },
            { id: 3, codigo: "003", nombre: "Válvula Carga Gas R22", precio: 75000, stock: 500, imagen: "003.jpg" },
            { id: 4, codigo: "004", nombre: "Válvula Carga Gas R410", precio: 75000, stock: 500, imagen: "004.jpg" },
            { id: 5, codigo: "005", nombre: "Filtro secador silica 6gr", precio: 12000, stock: 1500, imagen: "005.jpg" },
            { id: 6, codigo: "006", nombre: "Filtro secador silica 15gr", precio: 15000, stock: 1600, imagen: "006.jpg" },
            { id: 7, codigo: "007", nombre: "Filtro secador silica 30gr", precio: 18000, stock: 1000, imagen: "007.jpg" },
            { id: 8, codigo: "008", nombre: "Filtro secador sin silica", precio: 10000, stock: 1000, imagen: "008.jpg" },
            { id: 9, codigo: "009", nombre: "Conector Baja R134 vehículo", precio: 50000, stock: 200, imagen: "009.jpg" },
            { id: 10, codigo: "010", nombre: "Conector Alta R134 vehículo", precio: 50000, stock: 200, imagen: "010.jpg" },
            { id: 46, codigo: "046", nombre: "Filtro Tela Condensador", precio: 25000, stock: 1500, imagen: "046.jpg" },
            { id: 47, codigo: "047", nombre: "Aceite Refrigerante PAG46+UV 250ML", precio: 75000, stock: 720, imagen: "047.jpg" },
            { id: 48, codigo: "048", nombre: "Aceite Refrigerante PAG46 250ML", precio: 75000, stock: 504, imagen: "048.jpg" },
            { id: 49, codigo: "049", nombre: "Aceite Refrigerante PAG100+UV 250ML", precio: 75000, stock: 504, imagen: "049.jpg" },
            { id: 113, codigo: "113", nombre: "Extractor Núcleo Válvula R22/R410", precio: 115000, stock: 100, imagen: "113.jpg" },
            { id: 108, codigo: "108", nombre: "Cinta Terminación crema sin adhesivo", precio: 12000, stock: 5000, imagen: "108.jpg" }
          ]
        },

        "reguladores-manometros": {
          nombre: "Reguladores y Manómetros",
          descripcion: "Control de presión industrial y medicinal",
          icon: "fas fa-tachometer-alt",
          productos: [
            { id: 12, codigo: "012", nombre: "Regulador Presión Oxígeno Industrial", precio: 350000, stock: 200, imagen: "012.jpg" },
            { id: 13, codigo: "013", nombre: "Humidificador Aire Medicinal", precio: 80000, stock: 400, imagen: "013.jpg" },
            { id: 15, codigo: "015", nombre: "Manómetro Alta presión 300 Bar", precio: 70000, stock: 250, imagen: "015.jpg" },
            { id: 16, codigo: "016", nombre: "Manómetro caudal 30 Litros CO2/Argón", precio: 70000, stock: 200, imagen: "016.jpg" },
            { id: 17, codigo: "017", nombre: "Manómetro caudal 30 Bar Oxígeno/Nitrógeno", precio: 70000, stock: 200, imagen: "017.jpg" },
            { id: 20, codigo: "020", nombre: "Regulador medicinal c/Humidificador y Cánula", precio: 480000, stock: 150, imagen: "020.jpg" },
            { id: 21, codigo: "021", nombre: "Regulador Presión CO2 Industrial", precio: 350000, stock: 250, imagen: "021.jpg" },
            { id: 22, codigo: "022", nombre: "Regulador Presión Argón Industrial", precio: 350000, stock: 150, imagen: "022.jpg" },
            { id: 23, codigo: "023", nombre: "Regulador GLP Industrial 10kg y 45kg", precio: 330000, stock: 50, imagen: "023.jpg" },
            { id: 24, codigo: "024", nombre: "Regulador Nitrógeno alta presión salida 1/4", precio: 450000, stock: 200, imagen: "024.jpg" },
            { id: 88, codigo: "088", nombre: "Regulador Presión CO2 para Cerveza", precio: 450000, stock: 100, imagen: "088.jpg" }
          ]
        },

        "cilindros-tanques": {
          nombre: "Cilindros y Tanques",
          descripcion: "Diferentes capacidades para gases",
          icon: "fas fa-gas-pump",
          productos: [
            { id: 29, codigo: "029", nombre: "Cilindro 7.5m3 (Oxígeno/Argón/Nitrógeno)", precio: 2400000, stock: 25, imagen: "029.jpg" },
            { id: 30, codigo: "030", nombre: "Cilindro 6m3 + CO2 25kg", precio: 2200000, stock: 50, imagen: "030.jpg" },
            { id: 31, codigo: "031", nombre: "Cilindro 4m3 + CO2 20kg", precio: 1900000, stock: 75, imagen: "031.jpg" },
            { id: 32, codigo: "032", nombre: "Cilindro 3m3 + CO2 15kg", precio: 1600000, stock: 75, imagen: "032.jpg" },
            { id: 33, codigo: "033", nombre: "Cilindro 2.5m3 + CO2 10kg", precio: 1500000, stock: 75, imagen: "033.jpg" },
            { id: 34, codigo: "034", nombre: "Cilindro 1.5m3 + CO2 7kg", precio: 1400000, stock: 25, imagen: "034.jpg" }
          ]
        },

        "valvulas-cilindros": {
          nombre: "Válvulas para Cilindros",
          descripcion: "Válvulas especializadas por tipo de gas",
          icon: "fas fa-valve",
          productos: [
            { id: 35, codigo: "035", nombre: "Válvula CO2 Cilindro Aluminio", precio: 350000, stock: 100, imagen: "035.jpg" },
            { id: 36, codigo: "036", nombre: "Válvula Cilindro Argón", precio: 250000, stock: 150, imagen: "036.jpg" },
            { id: 37, codigo: "037", nombre: "Válvula Cilindro CO2", precio: 250000, stock: 150, imagen: "037.jpg" },
            { id: 38, codigo: "038", nombre: "Válvula Cilindro Acetileno", precio: 300000, stock: 25, imagen: "038.jpg" },
            { id: 39, codigo: "039", nombre: "Válvula Cilindro Oxígeno", precio: 250000, stock: 200, imagen: "039.jpg" }
          ]
        },

        "repuestos-radiadores": {
          nombre: "Repuestos Radiadores",
          descripcion: "Chapa, boquillas, fundente, varillas",
          icon: "fas fa-car",
          productos: [
            { id: 40, codigo: "040", nombre: "Boquilla Radiador Aluminio", precio: 20000, stock: 5000, imagen: "040.jpg" },
            { id: 41, codigo: "041", nombre: "Boquilla Radiador Bronce 0.9 Bar", precio: 25000, stock: 500, imagen: "041.jpg" },
            { id: 42, codigo: "042", nombre: "Tapa Radiador con resorte 0.9 Bar", precio: 15000, stock: 2000, imagen: "042.jpg" },
            { id: 43, codigo: "043", nombre: "Chapa Aluminio 50x100cm 1mm", precio: 75000, stock: 500, imagen: "043.jpg" },
            { id: 44, codigo: "044", nombre: "Chapa Aluminio 100x100cm 1mm", precio: 150000, stock: 500, imagen: "044.jpg" },
            { id: 45, codigo: "045", nombre: "Varilla Aluminio Soldadura 2.4mm", precio: 2000, stock: 5000, imagen: "045.jpg" }
          ]
        },

        "capacitores": {
          nombre: "Capacitores",
          descripcion: "Capacitores para equipos de refrigeración",
          icon: "fas fa-battery-half",
          productos: [
            { id: 50, codigo: "050", nombre: "Capacitor 2.5 MF 380V con ficha", precio: 10000, stock: 1000, imagen: "050.jpg" },
            { id: 51, codigo: "051", nombre: "Capacitor 2.4 MF 380V con cable", precio: 10000, stock: 1000, imagen: "051.jpg" },
            { id: 52, codigo: "052", nombre: "Capacitor Metálico 35MF 450V", precio: 20000, stock: 1000, imagen: "052.jpg" },
            { id: 53, codigo: "053", nombre: "Capacitor Metálico 45MF 450V", precio: 24000, stock: 700, imagen: "053.jpg" }
          ]
        },

        "cerveza-bar": {
          nombre: "Equipos Cerveza/Bar",
          descripcion: "Conectores, canillas y máquinas",
          icon: "fas fa-beer",
          productos: [
            { id: 54, codigo: "054", nombre: "Conector Barril Tipo G (Pilsen)", precio: 400000, stock: 100, imagen: "054.jpg" },
            { id: 55, codigo: "055", nombre: "Conector Barril Tipo A (Munich)", precio: 400000, stock: 100, imagen: "055.jpg" },
            { id: 56, codigo: "056", nombre: "Canilla Cerveza Ajustable", precio: 380000, stock: 20, imagen: "056.jpg" },
            { id: 57, codigo: "057", nombre: "Máquina Cerveza dos salidas completa", precio: 8000000, stock: 6, imagen: "057.jpg" },
            { id: 58, codigo: "058", nombre: "Bandeja Goteo Inoxidable 41x19x3cm", precio: 450000, stock: null, imagen: "058.jpg" }
          ]
        },

        "soldadura-tig": {
          nombre: "Soldadura TIG",
          descripcion: "Aportes, tungstenos y accesorios",
          icon: "fas fa-fire",
          productos: [
            { id: 28, codigo: "028", nombre: "Juego Pico Soldar con 3 Picos", precio: 480000, stock: 200, imagen: "028.jpg" },
            { id: 27, codigo: "027", nombre: "Lanza Corte Condor con puntera", precio: 750000, stock: 50, imagen: "027.jpg" },
            { id: 59, codigo: "059", nombre: "Aporte Inoxidable ER308L 1.2mm", precio: 130000, stock: 300, unidad: "kg", imagen: "059.jpg" },
            { id: 60, codigo: "060", nombre: "Aporte Inoxidable ER308L 1.6mm", precio: 120000, stock: 300, unidad: "kg", imagen: "060.jpg" },
            { id: 61, codigo: "061", nombre: "Aporte Inoxidable ER308 2.0mm", precio: 120000, stock: 200, unidad: "kg", imagen: "061.jpg" },
            { id: 62, codigo: "062", nombre: "Aporte Aluminio TIG 2.4mm", precio: 2500, stock: 1000, unidad: "UN", imagen: "062.jpg" },
            { id: 63, codigo: "063", nombre: "Aporte Aluminio TIG 3.2mm", precio: 3500, stock: 1000, unidad: "UN", imagen: "063.jpg" },
            { id: 111, codigo: "111", nombre: "TUNGSTENO Punta Roja 2.4mm INOX", precio: 20000, stock: 300, imagen: "111.jpg" },
            { id: 112, codigo: "112", nombre: "TUNGSTENO Punta Roja 1.6mm INOX", precio: 15000, stock: 200, imagen: "112.jpg" }
          ]
        },

        "gases-refrigerantes": {
          nombre: "Gases Refrigerantes",
          descripcion: "R22, R134, R410, R404 y más",
          icon: "fas fa-snowflake",
          productos: [
            { id: 64, codigo: "064", nombre: "Gas Refrigerante R22 13.6kg", precio: 1500000, stock: 100, imagen: "064.jpg" },
            { id: 65, codigo: "065", nombre: "Gas Refrigerante R134 13.6kg", precio: 1450000, stock: 100, imagen: "065.jpg" },
            { id: 66, codigo: "066", nombre: "Gas Refrigerante R410 11.3kg", precio: 1300000, stock: 100, imagen: "066.jpg" },
            { id: 67, codigo: "067", nombre: "Gas Refrigerante R404 10.2kg", precio: 1250000, stock: 100, imagen: "067.jpg" },
            { id: 68, codigo: "068", nombre: "Gas Refrigerante R404 9.5kg", precio: 1150000, stock: 100, imagen: "068.jpg" },
            { id: 69, codigo: "069", nombre: "Gas Refrigerante R600 400Gr", precio: 60000, stock: 100, imagen: "069.jpg" },
            { id: 70, codigo: "070", nombre: "Gas Map 400Gr Marca Global", precio: 45000, stock: 100, imagen: "070.jpg" }
          ]
        },

        "soportes-aire": {
          nombre: "Soportes Aire Acondicionado",
          descripcion: "Soportes universales y originales",
          icon: "fas fa-wind",
          productos: [
            { id: 71, codigo: "071", nombre: "Soporte Universal Ext 9K/12K/18K BTU", precio: 25000, stock: 100, imagen: "071.jpg" },
            { id: 72, codigo: "072", nombre: "Soporte Universal Int 9K/12K/18K BTU", precio: 30000, stock: 100, imagen: "072.jpg" },
            { id: 73, codigo: "073", nombre: "Soporte Original 9K/12K BTU", precio: 110000, stock: 50, imagen: "073.jpg" },
            { id: 74, codigo: "074", nombre: "Soporte Original 18K/24K BTU", precio: 120000, stock: 50, imagen: "074.jpg" },
            { id: 75, codigo: "075", nombre: "Soporte Original 36K BTU", precio: 130000, stock: 50, imagen: "075.jpg" },
            { id: 76, codigo: "076", nombre: "Soporte Original 48K/60K BTU", precio: 145000, stock: 50, imagen: "076.jpg" },
            { id: 77, codigo: "077", nombre: "Control Universal Aire", precio: 35000, stock: 50, imagen: "077.jpg" }
          ]
        },

        "canerias-cobre": {
          nombre: "Cañerías de Cobre",
          descripcion: "Diferentes medidas para instalaciones",
          icon: "fas fa-pipe",
          productos: [
            { id: 78, codigo: "078", nombre: "Cañería Cobre 3/16", precio: 240000, stock: 50, imagen: "078.jpg" },
            { id: 79, codigo: "079", nombre: "Cañería Cobre 1/4", precio: 255000, stock: 50, imagen: "079.jpg" },
            { id: 80, codigo: "080", nombre: "Cañería Cobre 5/16", precio: 315000, stock: 50, imagen: "080.jpg" },
            { id: 81, codigo: "081", nombre: "Cañería Cobre 3/8", precio: 370000, stock: 50, imagen: "081.jpg" },
            { id: 82, codigo: "082", nombre: "Cañería Cobre 1/2", precio: 470000, stock: 50, imagen: "082.jpg" },
            { id: 83, codigo: "083", nombre: "Cañería Cobre 5/8", precio: 590000, stock: 50, imagen: "083.jpg" },
            { id: 84, codigo: "084", nombre: "Cañería Cobre 3/4", precio: 705000, stock: 50, imagen: "084.jpg" }
          ]
        },

        "mangueras-accesorios": {
          nombre: "Mangueras y Accesorios",
          descripcion: "Conexiones y tuberías especializadas",
          icon: "fas fa-link",
          productos: [
            { id: 85, codigo: "085", nombre: "Manguera doble OXÍGENO/Gas 200mts", precio: 18000, stock: 200, unidad: "metro", imagen: "085.jpg" },
            { id: 86, codigo: "086", nombre: "Manguera Aire 5/16 100mts", precio: 10000, stock: 100, unidad: "metro", imagen: "086.jpg" },
            { id: 87, codigo: "087", nombre: "Anti retroceso llamas Oxígeno/Gas", precio: 250000, stock: 100, imagen: "087.jpg" },
            { id: 109, codigo: "109", nombre: "Manguera Flexible 130cm 3000 PSI", precio: 480000, stock: 100, imagen: "109.jpg" },
            { id: 110, codigo: "110", nombre: "Manguera Flexible 180cm 3000 PSI", precio: 650000, stock: 30, imagen: "110.jpg" }
          ]
        },

        "accesorios-varios": {
          nombre: "Accesorios Varios",
          descripcion: "Tuercas, adaptadores y componentes",
          icon: "fas fa-cogs",
          productos: [
            { id: 11, codigo: "011", nombre: "PEINE metálico enderezador evaporador", precio: 28000, stock: 100, imagen: "011.jpg" },
            { id: 14, codigo: "014", nombre: "Tuerca Bronce Oxígeno", precio: 70000, stock: 300, imagen: "014.jpg" },
            { id: 18, codigo: "018", nombre: "Tuerca Bronce CO2", precio: 70000, stock: 300, imagen: "018.jpg" },
            { id: 19, codigo: "019", nombre: "Tuerca Bronce Argón", precio: 70000, stock: 200, imagen: "019.jpg" },
            { id: 25, codigo: "025", nombre: "Adaptador Nitrógeno Paso Grueso", precio: 120000, stock: 150, imagen: "025.jpg" },
            { id: 26, codigo: "026", nombre: "Adaptador Nitrógeno Paso Fino", precio: 120000, stock: 150, imagen: "026.jpg" },
            { id: 89, codigo: "089", nombre: "Vástago Oxígeno", precio: 80000, stock: 100, imagen: "089.jpg" },
            { id: 90, codigo: "090", nombre: "Vástago CO2", precio: 80000, stock: 100, imagen: "090.jpg" },
            { id: 91, codigo: "091", nombre: "Vástago Argón", precio: 80000, stock: 100, imagen: "091.jpg" },
            { id: 114, codigo: "114", nombre: "Fundente Plata Cobre Argenta 50Gr", precio: 18000, stock: 100, imagen: "114.jpg" },
            { id: 115, codigo: "115", nombre: "Arandela Teflón Oxígeno/CO2", precio: 10000, stock: 1000, imagen: "115.jpg" }
          ]
        },

        "accesorios-vehiculos": {
          nombre: "Accesorios Vehículos",
          descripcion: "Accesorios para vehículos",
          icon: "fas fa-car-side",
          productos: [
            { id: 107, codigo: "107", nombre: "Baliza Doble con estuche plástico", precio: 25000, stock: 1000, imagen: "107.jpg" }
          ]
        },

        "extintores": {
          nombre: "Extintores",
          descripcion: "Venta y recarga de extintores",
          icon: "fas fa-fire-extinguisher",
          productos: [
            { id: 102, codigo: "102", nombre: "Extintor PQS 1kg Nuevo", precio: 120000, stock: null, imagen: "102.jpg" },
            { id: 103, codigo: "103", nombre: "Extintor PQS 2kg Nuevo", precio: 145000, stock: null, imagen: "103.jpg" },
            { id: 104, codigo: "104", nombre: "Extintor PQS 4kg Nuevo", precio: 230000, stock: null, imagen: "104.jpg" },
            { id: 105, codigo: "105", nombre: "Extintor PQS 6kg Nuevo", precio: 270000, stock: null, imagen: "105.jpg" },
            { id: 106, codigo: "106", nombre: "Extintor PQS 10kg Nuevo", precio: 350000, stock: null, imagen: "106.jpg" }
          ]
        },
        "varios": {
          nombre: "Productos Varios",
          descripcion: "Accesorios y herramientas diversas",
          icon: "fas fa-toolbox",
          productos: [
            { id: 108, codigo: "108", nombre: "Cinta Terminación crema sin adhesivo", precio: 12000, stock: 5000, imagen: "108.jpg" }
          ]
        },

        "servicios-recarga": {
          nombre: "Servicios de Recarga",
          descripcion: "Recarga de gases y extintores",
          icon: "fas fa-sync-alt",
          productos: [
            { id: 92, codigo: "092", nombre: "Recarga Oxígeno M3", precio: 35000, stock: null, unidad: "servicio", imagen: "092.jpg" },
            { id: 93, codigo: "093", nombre: "Recarga Argón M3", precio: 130000, stock: null, unidad: "servicio", imagen: "093.jpg" },
            { id: 94, codigo: "094", nombre: "Recarga Nitrógeno M3", precio: 35000, stock: null, unidad: "servicio", imagen: "094.jpg" },
            { id: 95, codigo: "095", nombre: "Recarga CO2 10kg", precio: 160000, stock: null, unidad: "servicio", imagen: "095.jpg" },
            { id: 96, codigo: "096", nombre: "Recarga CO2 20kg", precio: 320000, stock: null, unidad: "servicio", imagen: "096.jpg" },
            { id: 97, codigo: "097", nombre: "Recarga Acetileno 1kg", precio: 250000, stock: null, unidad: "servicio", imagen: "097.jpg" },
            { id: 98, codigo: "098", nombre: "Recarga Extintor PQS 1kg", precio: 50000, stock: null, unidad: "servicio", imagen: "098.jpg" },
            { id: 99, codigo: "099", nombre: "Recarga Extintor PQS 4kg", precio: 75000, stock: null, unidad: "servicio", imagen: "099.jpg" },
            { id: 100, codigo: "100", nombre: "Recarga Extintor PQS 6kg", precio: 90000, stock: null, unidad: "servicio", imagen: "100.jpg" },
            { id: 101, codigo: "101", nombre: "Recarga Extintor PQS 10kg", precio: 140000, stock: null, unidad: "servicio", imagen: "101.jpg" }
          ]
        },

        /* === Nuevas categorías duplicando cilindros como tubos === */
        "tubos-oxigeno": {
          nombre: "Tubos de Oxígeno",
          descripcion: "Tubos/cilindros para oxígeno",
          icon: "fas fa-gas-pump",
          productos: [
            { id: 29, codigo: "029", nombre: "Tubo Oxígeno 7.5m3 (Oxígeno/Argón/Nitrógeno)", precio: 2400000, stock: 25, imagen: "029.jpg" },
            { id: 30, codigo: "030", nombre: "Tubo Oxígeno 6m3 + CO2 25kg", precio: 2200000, stock: 50, imagen: "030.jpg" },
            { id: 31, codigo: "031", nombre: "Tubo Oxígeno 4m3 + CO2 20kg", precio: 1900000, stock: 75, imagen: "031.jpg" },
            { id: 32, codigo: "032", nombre: "Tubo Oxígeno 3m3 + CO2 15kg", precio: 1600000, stock: 75, imagen: "032.jpg" },
            { id: 33, codigo: "033", nombre: "Tubo Oxígeno 2.5m3 + CO2 10kg", precio: 1500000, stock: 75, imagen: "033.jpg" },
            { id: 34, codigo: "034", nombre: "Tubo Oxígeno 1.5m3 + CO2 7kg", precio: 1400000, stock: 25, imagen: "034.jpg" }
          ]
        },

        "tubos-nitrogeno": {
          nombre: "Tubos de Nitrógeno",
          descripcion: "Tubos/cilindros para nitrógeno",
          icon: "fas fa-gas-pump",
          productos: [
            { id: 29, codigo: "029", nombre: "Tubo Nitrógeno 7.5m3 (Oxígeno/Argón/Nitrógeno)", precio: 2400000, stock: 25, imagen: "029.jpg" },
            { id: 30, codigo: "030", nombre: "Tubo Nitrógeno 6m3 + CO2 25kg", precio: 2200000, stock: 50, imagen: "030.jpg" },
            { id: 31, codigo: "031", nombre: "Tubo Nitrógeno 4m3 + CO2 20kg", precio: 1900000, stock: 75, imagen: "031.jpg" },
            { id: 32, codigo: "032", nombre: "Tubo Nitrógeno 3m3 + CO2 15kg", precio: 1600000, stock: 75, imagen: "032.jpg" },
            { id: 33, codigo: "033", nombre: "Tubo Nitrógeno 2.5m3 + CO2 10kg", precio: 1500000, stock: 75, imagen: "033.jpg" },
            { id: 34, codigo: "034", nombre: "Tubo Nitrógeno 1.5m3 + CO2 7kg", precio: 1400000, stock: 25, imagen: "034.jpg" }
          ]
        },

        "tubos-co2": {
          nombre: "Tubos de CO2",
          descripcion: "Tubos/cilindros para dióxido de carbono",
          icon: "fas fa-gas-pump",
          productos: [
            { id: 29, codigo: "029", nombre: "Tubo CO2 7.5m3 (Oxígeno/Argón/Nitrógeno)", precio: 2400000, stock: 25, imagen: "029.jpg" },
            { id: 30, codigo: "030", nombre: "Tubo CO2 6m3 + CO2 25kg", precio: 2200000, stock: 50, imagen: "030.jpg" },
            { id: 31, codigo: "031", nombre: "Tubo CO2 4m3 + CO2 20kg", precio: 1900000, stock: 75, imagen: "031.jpg" },
            { id: 32, codigo: "032", nombre: "Tubo CO2 3m3 + CO2 15kg", precio: 1600000, stock: 75, imagen: "032.jpg" },
            { id: 33, codigo: "033", nombre: "Tubo CO2 2.5m3 + CO2 10kg", precio: 1500000, stock: 75, imagen: "033.jpg" },
            { id: 34, codigo: "034", nombre: "Tubo CO2 1.5m3 + CO2 7kg", precio: 1400000, stock: 25, imagen: "034.jpg" }
          ]
        },

        "tubos-argon": {
          nombre: "Tubos de Argón",
          descripcion: "Tubos/cilindros para argón",
          icon: "fas fa-gas-pump",
          productos: [
            { id: 29, codigo: "029", nombre: "Tubo Argón 7.5m3 (Oxígeno/Argón/Nitrógeno)", precio: 2400000, stock: 25, imagen: "029.jpg" },
            { id: 30, codigo: "030", nombre: "Tubo Argón 6m3 + CO2 25kg", precio: 2200000, stock: 50, imagen: "030.jpg" },
            { id: 31, codigo: "031", nombre: "Tubo Argón 4m3 + CO2 20kg", precio: 1900000, stock: 75, imagen: "031.jpg" },
            { id: 32, codigo: "032", nombre: "Tubo Argón 3m3 + CO2 15kg", precio: 1600000, stock: 75, imagen: "032.jpg" },
            { id: 33, codigo: "033", nombre: "Tubo Argón 2.5m3 + CO2 10kg", precio: 1500000, stock: 75, imagen: "033.jpg" },
            { id: 34, codigo: "034", nombre: "Tubo Argón 1.5m3 + CO2 7kg", precio: 1400000, stock: 25, imagen: "034.jpg" }
          ]
        }
      }
    };


    // Variables globales
    let currentCategory = 'todos';
    let cart = [];
    let allProducts = [];

    // Inicializar la aplicación
    document.addEventListener('DOMContentLoaded', function () {
      initializeApp();
    });

    function initializeApp() {
      loadAllProducts();
      renderCategories();
      renderProducts();
      renderCart();
      setupEventListeners();
      applyPreselectionFromURL();   // ⬅️ NUEVO: intenta preseleccionar por ?producto=CODIGO
    }
    // Preselección desde la URL: ?producto=CODIGO


    function loadAllProducts() {
      allProducts = [];
      Object.keys(productDatabase.categorias).forEach(categoryKey => {
        const category = productDatabase.categorias[categoryKey];
        category.productos.forEach(product => {
          allProducts.push({
            ...product,
            categoria: categoryKey,
            categoriaNombre: category.nombre
          });
        });
      });
    }

    function renderCategories() {
      const categoriesList = document.getElementById('categoriesList');

      categoriesList.innerHTML = `
                <div class="category-item ${currentCategory === 'todos' ? 'active' : ''}" 
                     onclick="selectCategory('todos')">
                    <div class="category-icon">
                        <i class="fas fa-th-large" style="color: var(--pms-blue);"></i>
                    </div>
                    <div class="category-info">
                        <h3>Todos los Productos</h3>
                        <p>${allProducts.length} productos</p>
                    </div>
                </div>
            `;

      Object.keys(productDatabase.categorias).forEach(categoryKey => {
        const category = productDatabase.categorias[categoryKey];
        const productCount = category.productos.length;

        categoriesList.innerHTML += `
                    <div class="category-item ${currentCategory === categoryKey ? 'active' : ''}" 
                         onclick="selectCategory('${categoryKey}')">
                        <div class="category-icon">
                            <i class="${category.icon}" style="color: var(--pms-green);"></i>
                        </div>
                        <div class="category-info">
                            <h3>${category.nombre}</h3>
                            <p>${productCount} productos</p>
                        </div>
                    </div>
                `;
      });
    }

    function selectCategory(categoryKey) {
      currentCategory = categoryKey;
      renderCategories();
      renderProducts();

      const categoryTitle = document.getElementById('categoryTitle');
      if (categoryKey === 'todos') {
        categoryTitle.textContent = 'Todos los Productos';
      } else {
        categoryTitle.textContent = productDatabase.categorias[categoryKey].nombre;
      }
    }

    function renderProducts() {
      const productsGrid = document.getElementById('productsGrid');
      let productsToShow = [];

      if (currentCategory === 'todos') {
        productsToShow = allProducts;
      } else {
        productsToShow = productDatabase.categorias[currentCategory].productos.map(product => ({
          ...product,
          categoria: currentCategory,
          categoriaNombre: productDatabase.categorias[currentCategory].nombre
        }));
      }

      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      if (searchTerm) {
        productsToShow = productsToShow.filter(product =>
          product.nombre.toLowerCase().includes(searchTerm) ||
          product.codigo.toLowerCase().includes(searchTerm)
        );
      }

      productsGrid.innerHTML = '';

      if (productsToShow.length === 0) {
        productsGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--pms-gray);">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <h3>No se encontraron productos</h3>
                        <p>Intenta con otros términos de búsqueda</p>
                    </div>
                `;
        return;
      }

      productsToShow.forEach(product => {
        const stockInfo = getStockInfo(product);
        const imageUrl = `imagenes/${product.imagen}`;

        productsGrid.innerHTML += `
                    <div class="product-card" id="prod-${product.codigo}" data-code="${product.codigo}">
                        <div class="product-image">
                            <img src="${imageUrl}" alt="${product.nombre}" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                                 onload="this.nextElementSibling.style.display='none';">
                            <div class="placeholder-icon" style="display: none;">
                                <i class="fas fa-image"></i>
                            </div>
                        </div>
                        <div class="product-code">Código: ${product.codigo}</div>
                        <h3>${product.nombre}</h3>
                        <div class="product-stock ${stockInfo.class}">${stockInfo.text}</div>
                        <div class="product-price">₲ ${formatPrice(product.precio)}</div>
                        <div class="product-actions">
                            <div class="quantity-selector">
                                <button class="quantity-btn" onclick="changeQuantity(${product.id}, -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" value="1" min="1" max="999" 
                                       class="quantity-input" id="qty-${product.id}">
                                <button class="quantity-btn" onclick="changeQuantity(${product.id}, 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <button class="add-to-cart" onclick="addToCart(${product.id})" 
                                    ${stockInfo.disabled ? 'disabled' : ''}>
                                <i class="fas fa-cart-plus"></i> Agregar
                            </button>
                        </div>
                    </div>
                `;
      });
    }

    function getStockInfo(product) {
      if (product.stock === null) {
        return { text: 'Consultar disponibilidad', class: '', disabled: false };
      }
      if (product.stock === 0) {
        return { text: 'Sin stock', class: 'low', disabled: true };
      }
      if (product.stock < 10) {
        return { text: `Stock bajo: ${product.stock} unidades`, class: 'low', disabled: false };
      }
      return { text: `Stock: ${product.stock} unidades`, class: '', disabled: false };
    }

    function formatPrice(price) {
      return price.toLocaleString('es-PY');
    }

    function changeQuantity(productId, change) {
      const qtyInput = document.getElementById(`qty-${productId}`);
      let currentQty = parseInt(qtyInput.value) || 1;
      let newQty = currentQty + change;

      if (newQty < 1) newQty = 1;
      if (newQty > 999) newQty = 999;

      qtyInput.value = newQty;
    }

    function addToCart(productId) {
      const product = findProductById(productId);
      const qtyInput = document.getElementById(`qty-${productId}`);
      const quantity = parseInt(qtyInput.value) || 1;

      if (!product) return;

      const existingItem = cart.find(item => item.id === productId);

      if (existingItem) {
        existingItem.cantidad += quantity;
      } else {
        cart.push({
          ...product,
          cantidad: quantity
        });
      }

      qtyInput.value = 1;
      renderCart();
      updateCartCounter();
      showNotification(`${product.nombre} agregado al carrito`);
    }

    function findProductById(productId) {
      return allProducts.find(product => product.id === productId);
    }

    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      renderCart();
      updateCartCounter();
    }

    function updateCartQuantity(productId, newQuantity) {
      const item = cart.find(item => item.id === productId);
      if (item) {
        if (newQuantity <= 0) {
          removeFromCart(productId);
        } else {
          item.cantidad = newQuantity;
          renderCart();
          updateCartCounter();
        }
      }
    }

    function renderCart() {
      const cartContent = document.getElementById('cartContent');

      if (cart.length === 0) {
        cartContent.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Tu carrito está vacío</p>
                        <small>Agrega productos para comenzar tu pedido</small>
                    </div>
                `;
        return;
      }

      let cartHTML = '<div class="cart-items">';
      let total = 0;

      cart.forEach(item => {
        const subtotal = item.precio * item.cantidad;
        total += subtotal;

        cartHTML += `
                    <div class="cart-item">
                        <button class="remove-item" onclick="removeFromCart(${item.id})">
                            <i class="fas fa-times"></i>
                        </button>
                        <h4>${item.nombre}</h4>
                        <div class="cart-item-details">
                            <span class="cart-item-price">₲ ${formatPrice(item.precio)}</span>
                            <span class="cart-item-quantity">x${item.cantidad}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <button onclick="updateCartQuantity(${item.id}, ${item.cantidad - 1})" 
                                        style="background: var(--pms-light); border: none; border-radius: 3px; width: 25px; height: 25px; cursor: pointer;">
                                    <i class="fas fa-minus" style="font-size: 0.7rem;"></i>
                                </button>
                                <span style="min-width: 30px; text-align: center;">${item.cantidad}</span>
                                <button onclick="updateCartQuantity(${item.id}, ${item.cantidad + 1})" 
                                        style="background: var(--pms-light); border: none; border-radius: 3px; width: 25px; height: 25px; cursor: pointer;">
                                    <i class="fas fa-plus" style="font-size: 0.7rem;"></i>
                                </button>
                            </div>
                            <strong style="color: var(--pms-blue);">₲ ${formatPrice(subtotal)}</strong>
                        </div>
                    </div>
                `;
      });

      cartHTML += '</div>';
      cartHTML += `
                <div class="cart-summary">
                    <div class="cart-total">
                        Total: ₲ ${formatPrice(total)}
                    </div>
                    <button class="checkout-btn" onclick="openCustomerForm()">
                        <i class="fab fa-whatsapp"></i> Enviar Pedido por WhatsApp
                    </button>
                </div>
            `;

      cartContent.innerHTML = cartHTML;
    }

    function updateCartCounter() {
      const cartCount = document.getElementById('cartCount');
      const totalItems = cart.reduce((sum, item) => sum + item.cantidad, 0);
      cartCount.textContent = totalItems;
      cartCount.style.display = totalItems > 0 ? 'flex' : 'none';
    }
    function applyPreselectionFromURL() {
      const params = new URLSearchParams(window.location.search);
      const cod = (params.get('producto') || '').trim();
      if (!cod) return;

      // 1) Ubicar el producto en la data
      const p = allProducts.find(x => (x.codigo + '').toLowerCase() === cod.toLowerCase());
      if (!p) return;

      // 2) Cambiar a su categoría y renderizar
      currentCategory = p.categoria;     // <- ajustá el nombre del campo según tu data
      renderCategories();
      renderProducts();

      // 3) Scroll y highlight a la tarjeta, sin tocar el buscador
      requestAnimationFrame(() => {
        // buscar por id o data-code
        const selector = `#prod-${CSS.escape(cod)}`;
        const el = document.querySelector(selector) || document.querySelector(`[data-code="${CSS.escape(cod)}"]`);
        if (!el) return;

        const HEADER_H = 72; // altura de tu header fijo
        const y = el.getBoundingClientRect().top + window.pageYOffset - HEADER_H - 12;
        window.scrollTo({ top: y, behavior: 'smooth' });

        el.classList.add('highlight-card');
        setTimeout(() => el.classList.remove('highlight-card'), 2500);
      });
    }

    // FUNCIÓN PRINCIPAL - ABRIR FORMULARIO CLIENTE
    function openCustomerForm() {
      console.log('openCustomerForm ejecutándose...');

      if (cart.length === 0) {
        alert('Tu carrito está vacío. Agrega productos antes de continuar.');
        return;
      }

      showCustomerFormPopup();
    }

    function showCustomerFormPopup() {
      // Crear overlay
      const overlay = document.createElement('div');
      overlay.id = 'formOverlay';
      overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
                padding: 1rem;
            `;

      // Crear formulario popup
      const formPopup = document.createElement('div');
      formPopup.style.cssText = `
                background: white;
                border-radius: 20px;
                padding: 2.5rem;
                width: 100%;
                max-width: 550px;
                max-height: 95vh;
                overflow-y: auto;
                box-shadow: 0 25px 80px rgba(0,0,0,0.4);
                animation: slideInUp 0.4s ease;
                position: relative;
            `;

      formPopup.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 3px solid var(--pms-blue); padding-bottom: 1rem;">
                    <h2 style="color: var(--pms-dark); margin: 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.5rem;">
                        <i class="fas fa-user-edit" style="color: var(--pms-blue);"></i>
                        Datos del Cliente
                    </h2>
                    <button onclick="closeCustomerForm()" style="background: var(--pms-red); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; transition: all 0.3s;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="customerForm" style="display: grid; gap: 2rem;">
                    <!-- Información Personal -->
                    <div style="background: linear-gradient(135deg, var(--pms-light), #ffffff); padding: 2rem; border-radius: 15px; border: 1px solid #e0e0e0;">
                        <h3 style="color: var(--pms-blue); margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.2rem;">
                            <i class="fas fa-user"></i> Información Personal
                        </h3>
                        <div style="display: grid; gap: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: var(--pms-dark); font-size: 0.95rem;">
                                    Nombre Completo *
                                </label>
                                <input type="text" id="customerName" required 
                                       style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; transition: all 0.3s;"
                                       placeholder="Ej: Juan Pérez">
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: var(--pms-dark); font-size: 0.95rem;">
                                        Teléfono *
                                    </label>
                                    <input type="tel" id="customerPhone" required 
                                           style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; transition: all 0.3s;"
                                           placeholder="0981 123 456">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: var(--pms-dark); font-size: 0.95rem;">
                                        Email
                                    </label>
                                    <input type="email" id="customerEmail" 
                                           style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; transition: all 0.3s;"
                                           placeholder="juan@email.com">
                                </div>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: var(--pms-dark); font-size: 0.95rem;">
                                    Empresa/Institución
                                </label>
                                <input type="text" id="customerCompany" 
                                       style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; transition: all 0.3s;"
                                       placeholder="Empresa ABC S.A.">
                            </div>
                        </div>
                    </div>

                    <!-- Entrega -->
                    <div style="background: linear-gradient(135deg, var(--pms-light), #ffffff); padding: 2rem; border-radius: 15px; border: 1px solid #e0e0e0;">
                        <h3 style="color: var(--pms-green); margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.2rem;">
                            <i class="fas fa-shipping-fast"></i> Tipo de Entrega
                        </h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                            <label class="delivery-option" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s; background: white;">
                                <input type="radio" name="deliveryType" value="retiro" id="retiro" style="transform: scale(1.3); accent-color: var(--pms-blue);">
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.3rem;">
                                        <i class="fas fa-store" style="color: var(--pms-blue); font-size: 1.2rem;"></i>
                                        <strong style="color: var(--pms-dark);">Retiro en Local</strong>
                                    </div>
                                    <small style="color: var(--pms-gray);">Villa Elisa - Sin costo</small>
                                </div>
                            </label>
                            <label class="delivery-option" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s; background: white;">
                                <input type="radio" name="deliveryType" value="delivery" id="delivery" style="transform: scale(1.3); accent-color: var(--pms-green);">
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.3rem;">
                                        <i class="fas fa-truck" style="color: var(--pms-green); font-size: 1.2rem;"></i>
                                        <strong style="color: var(--pms-dark);">Delivery</strong>
                                    </div>
                                    <small style="color: var(--pms-gray);">A domicilio - Consultar costo</small>
                                </div>
                            </label>
                        </div>
                        <div id="addressSection" style="display: none;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: var(--pms-dark); font-size: 0.95rem;">
                                Dirección de Entrega *
                            </label>
                            <textarea id="customerAddress" rows="3" 
                                      style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; resize: vertical; transition: all 0.3s;"
                                      placeholder="Dirección completa con referencias..."></textarea>
                        </div>
                    </div>

                    <!-- Forma de Pago -->
                    <div style="background: linear-gradient(135deg, var(--pms-light), #ffffff); padding: 2rem; border-radius: 15px; border: 1px solid #e0e0e0;">
                        <h3 style="color: var(--pms-blue); margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.2rem;">
                            <i class="fas fa-credit-card"></i> Forma de Pago
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem;">
                            <label class="payment-option" style="display: flex; align-items: center; gap: 0.8rem; padding: 1rem; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s; background: white;">
                                <input type="radio" name="paymentMethod" value="efectivo" style="transform: scale(1.3); accent-color: var(--pms-green);">
                                <i class="fas fa-money-bill-wave" style="color: var(--pms-green); font-size: 1.2rem;"></i>
                                <span style="font-weight: 500;">Efectivo</span>
                            </label>
                            <label class="payment-option" style="display: flex; align-items: center; gap: 0.8rem; padding: 1rem; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s; background: white;">
                                <input type="radio" name="paymentMethod" value="transferencia" style="transform: scale(1.3); accent-color: var(--pms-blue);">
                                <i class="fas fa-university" style="color: var(--pms-blue); font-size: 1.2rem;"></i>
                                <span style="font-weight: 500;">Transferencia</span>
                            </label>
                            <label class="payment-option" style="display: flex; align-items: center; gap: 0.8rem; padding: 1rem; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s; background: white;">
                                <input type="radio" name="paymentMethod" value="tarjeta" style="transform: scale(1.3); accent-color: var(--pms-red);">
                                <i class="fas fa-credit-card" style="color: var(--pms-red); font-size: 1.2rem;"></i>
                                <span style="font-weight: 500;">Tarjeta</span>
                            </label>
                        </div>
                    </div>

                    <!-- Observaciones -->
                    <div style="background: linear-gradient(135deg, var(--pms-light), #ffffff); padding: 2rem; border-radius: 15px; border: 1px solid #e0e0e0;">
                        <h3 style="color: var(--pms-gray); margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.2rem;">
                            <i class="fas fa-sticky-note"></i> Observaciones
                        </h3>
                        <textarea id="customerNotes" rows="3" 
                                  style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; resize: vertical; transition: all 0.3s;"
                                  placeholder="Comentarios adicionales, urgencia, horarios preferidos, etc."></textarea>
                    </div>

                    <!-- Botones -->
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button type="button" onclick="closeCustomerForm()" 
                                style="flex: 1; background: var(--pms-gray); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-size: 1rem; cursor: pointer; transition: all 0.3s; font-weight: 500;">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="submit" 
                                style="flex: 2; background: linear-gradient(135deg, var(--pms-green), #00CC99); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0, 170, 136, 0.3);">
                            <i class="fab fa-whatsapp"></i> Generar Pedido WhatsApp
                        </button>
                    </div>
                </form>
            `;

      overlay.appendChild(formPopup);
      document.body.appendChild(overlay);

      // Agregar event listeners para las opciones
      setupFormEventListeners();

      // Focus en el primer campo
      setTimeout(() => {
        document.getElementById('customerName').focus();
      }, 400);
    }

    function setupFormEventListeners() {
      // Manejar envío del formulario
      document.getElementById('customerForm').addEventListener('submit', function (e) {
        e.preventDefault();
        processFormData();
      });

      // Event listeners para delivery options
      document.querySelectorAll('input[name="deliveryType"]').forEach(radio => {
        radio.addEventListener('change', function () {
          updateDeliverySelection();
        });
      });

      // Event listeners para payment options
      document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
        radio.addEventListener('change', function () {
          updatePaymentSelection();
        });
      });

      // Event listeners para hover effects en las opciones
      document.querySelectorAll('.delivery-option, .payment-option').forEach(option => {
        option.addEventListener('mouseenter', function () {
          if (!this.querySelector('input').checked) {
            this.style.borderColor = 'var(--pms-blue)';
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 12px rgba(0, 102, 204, 0.15)';
          }
        });

        option.addEventListener('mouseleave', function () {
          if (!this.querySelector('input').checked) {
            this.style.borderColor = '#ddd';
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
          }
        });
      });

      // Focus effects para inputs
      document.querySelectorAll('#formOverlay input, #formOverlay textarea').forEach(input => {
        input.addEventListener('focus', function () {
          this.style.borderColor = 'var(--pms-blue)';
          this.style.boxShadow = '0 0 0 3px rgba(0, 102, 204, 0.1)';
        });

        input.addEventListener('blur', function () {
          this.style.borderColor = '#ddd';
          this.style.boxShadow = 'none';
        });
      });
    }

    function updateDeliverySelection() {
      const addressSection = document.getElementById('addressSection');
      const selectedDelivery = document.querySelector('input[name="deliveryType"]:checked');

      // Reset all delivery options
      document.querySelectorAll('.delivery-option').forEach(option => {
        option.style.borderColor = '#ddd';
        option.style.background = 'white';
        option.style.transform = 'translateY(0)';
        option.style.boxShadow = 'none';
      });

      if (selectedDelivery) {
        const selectedOption = selectedDelivery.closest('.delivery-option');
        selectedOption.style.borderColor = selectedDelivery.value === 'delivery' ? 'var(--pms-green)' : 'var(--pms-blue)';
        selectedOption.style.background = selectedDelivery.value === 'delivery' ? 'rgba(0, 170, 136, 0.05)' : 'rgba(0, 102, 204, 0.05)';
        selectedOption.style.boxShadow = '0 4px 12px rgba(0, 170, 136, 0.2)';

        // Show/hide address section
        if (selectedDelivery.value === 'delivery') {
          addressSection.style.display = 'block';
          document.getElementById('customerAddress').required = true;
        } else {
          addressSection.style.display = 'none';
          document.getElementById('customerAddress').required = false;
        }
      }
    }

    function updatePaymentSelection() {
      const selectedPayment = document.querySelector('input[name="paymentMethod"]:checked');

      // Reset all payment options
      document.querySelectorAll('.payment-option').forEach(option => {
        option.style.borderColor = '#ddd';
        option.style.background = 'white';
        option.style.transform = 'translateY(0)';
        option.style.boxShadow = 'none';
      });

      if (selectedPayment) {
        const selectedOption = selectedPayment.closest('.payment-option');
        const colors = {
          'efectivo': 'var(--pms-green)',
          'transferencia': 'var(--pms-blue)',
          'tarjeta': 'var(--pms-red)'
        };
        const color = colors[selectedPayment.value];
        selectedOption.style.borderColor = color;
        selectedOption.style.background = `${color}15`; // 15 is hex for low opacity
        selectedOption.style.boxShadow = `0 4px 12px ${color}30`; // 30 is hex for medium opacity
      }
    }

    function closeCustomerForm() {
      const overlay = document.getElementById('formOverlay');
      if (overlay) {
        overlay.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => {
          if (document.body.contains(overlay)) {
            document.body.removeChild(overlay);
          }
        }, 300);
      }
    }

    function processFormData() {
      // Obtener datos del formulario
      const customerData = {
        name: document.getElementById('customerName').value.trim(),
        phone: document.getElementById('customerPhone').value.trim(),
        email: document.getElementById('customerEmail').value.trim(),
        company: document.getElementById('customerCompany').value.trim(),
        deliveryType: document.querySelector('input[name="deliveryType"]:checked')?.value,
        address: document.getElementById('customerAddress').value.trim(),
        paymentMethod: document.querySelector('input[name="paymentMethod"]:checked')?.value,
        notes: document.getElementById('customerNotes').value.trim()
      };

      // Validaciones
      if (!customerData.name) {
        alert('Por favor, ingresa tu nombre completo.');
        document.getElementById('customerName').focus();
        return;
      }
      if (!customerData.phone) {
        alert('Por favor, ingresa tu teléfono.');
        document.getElementById('customerPhone').focus();
        return;
      }
      if (!customerData.deliveryType) {
        alert('Por favor, selecciona el tipo de entrega.');
        return;
      }
      if (customerData.deliveryType === 'delivery' && !customerData.address) {
        alert('Por favor, ingresa la dirección de entrega.');
        document.getElementById('customerAddress').focus();
        return;
      }

      console.log('Datos del cliente:', customerData);

      // Generar mensaje y cerrar formulario
      generateWhatsAppMessage(customerData);
      closeCustomerForm();
    }
    // Emojis seguros con escapes Unicode
    const E = {
      fabrica: "\uD83C\uDFED",      // 🏭
      calendario: "\uD83D\uDCC5",   // 📅
      reloj: "\uD83D\uDD50",        // 🕐
      persona: "\uD83D\uDC64",      // 👤
      camion: "\uD83D\uDE9A",       // 🚚
      delivery: "\uD83D\uDE9B",     // 🚛
      dinero: "\uD83D\uDCB5",       // 💵
      banco: "\uD83C\uDFE6",        // 🏦
      tarjeta: "\uD83D\uDCB3",      // 💳
      paquete: "\uD83D\uDCE6",      // 📦
      nota: "\uD83D\uDCDD",         // 📝
      grafica: "\uD83D\uDCCA",      // 📊
      monedero: "\uD83D\uDCB0",     // 💰
      telefono: "\uD83D\uDCDE",     // 📞
      check: "\u2705",              // ✅
      cohete: "\uD83D\uDE80"        // 🚀
    };

    function generateWhatsAppMessage(customerData) {
      console.log('Generando mensaje de WhatsApp...');

      const fecha = new Date().toLocaleDateString('es-PY');
      const hora = new Date().toLocaleTimeString('es-PY', {
        hour12: true,
        hour: 'numeric',
        minute: '2-digit',
        second: '2-digit'
      });

      let mensaje = `${E.fabrica} *PEDIDO PMS - PROYECTOS MONTAJES SEGURIDAD*\n`;
      mensaje += `${E.calendario} Fecha: ${fecha}\n`;
      mensaje += `${E.reloj} Hora: ${hora}\n\n`;

      mensaje += `${E.persona} *DATOS DEL CLIENTE:*\n`;
      mensaje += `Nombre: ${customerData.name}\n`;
      mensaje += `Teléfono: ${customerData.phone}\n`;
      if (customerData.email) mensaje += `Email: ${customerData.email}\n`;
      if (customerData.company) mensaje += `Empresa: ${customerData.company}\n`;

      mensaje += `\n${E.camion} *ENTREGA:*\n`;
      if (customerData.deliveryType === 'retiro') {
        mensaje += `📍 Retiro en Local - Villa Elisa\n`;
        mensaje += `Ruta PY 01 acceso sur nro 1082 casi Boquerón\n`;
      } else {
        mensaje += `${E.delivery} Delivery a Domicilio\n`;
        mensaje += `Dirección: ${customerData.address}\n`;
      }

      mensaje += `\n${E.tarjeta} *FORMA DE PAGO:*\n`;
      const paymentLabels = {
        'efectivo': `${E.dinero} Efectivo`,
        'transferencia': `${E.banco} Transferencia Bancaria`,
        'tarjeta': `${E.tarjeta} Tarjeta de Crédito/Débito`
      };
      mensaje += `${paymentLabels[customerData.paymentMethod] || `${E.dinero} Efectivo`}\n`;

      mensaje += `\n${E.paquete} *DETALLE DEL PEDIDO:*\n`;
      mensaje += `════════════════════════════\n`;

      let total = 0;
      cart.forEach((item, index) => {
        const subtotal = item.precio * item.cantidad;
        total += subtotal;

        mensaje += `${index + 1}. *${item.nombre}*\n`;
        mensaje += `   ${E.nota} Código: ${item.codigo}\n`;
        mensaje += `   ${E.grafica} Cantidad: ${item.cantidad} ${item.unidad || 'unidades'}\n`;
        mensaje += `   ${E.monedero} Precio Unit: ₲ ${formatPrice(item.precio)}\n`;
        mensaje += `   ${E.dinero} Subtotal: ₲ ${formatPrice(subtotal)}\n`;
        mensaje += `────────────────────────────\n`;
      });

      mensaje += `\n${E.monedero} *TOTAL PEDIDO: ₲ ${formatPrice(total)}*\n\n`;

      if (customerData.notes && customerData.notes.trim()) {
        mensaje += `📝 *OBSERVACIONES:*\n`;
        mensaje += `${customerData.notes}\n\n`;
      }

      mensaje += `${E.telefono} *CONTACTO PMS:*\n`;
      mensaje += `Villa Elisa - Paraguay\n`;
      mensaje += `Teléfono: 0985 920 400\n`;
      mensaje += `Email: ventas@pms.com.py\n\n`;

      mensaje += `${E.check} *Gracias por confiar en PMS!*\n`;
      mensaje += `${E.cohete} Responderemos a la brevedad`;

      console.log('Mensaje generado, abriendo WhatsApp...');

      // Codificar y abrir
      const whatsappURL = "https://api.whatsapp.com/send?phone=595985920400&text=" + encodeURIComponent(mensaje);
      window.open(whatsappURL, '_blank');

      // Limpiar carrito
      cart = [];
      renderCart();
      updateCartCounter();

      showNotification('¡Pedido enviado por WhatsApp correctamente!');
    }

    function setupEventListeners() {
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', function () {
        renderProducts();
      });

      searchInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          renderProducts();
        }
      });
    }

    function scrollToCart() {
      const cartSidebar = document.querySelector('.cart-sidebar');
      cartSidebar.scrollIntoView({ behavior: 'smooth' });
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--pms-green);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                z-index: 10000;
                font-weight: bold;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                animation: slideInRight 0.3s ease;
            `;
      notification.textContent = message;

      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => {
          if (document.body.contains(notification)) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Función de testing
    function testForm() {
      console.log('Test function ejecutándose...');
      openCustomerForm();
    }

  </script>
</body>

</html>